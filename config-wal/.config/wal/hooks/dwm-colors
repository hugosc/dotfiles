#!/bin/bash
# Add dwm-specific color definitions to Xresources

XRES_FILE="$HOME/.cache/wal/colors.Xresources"
COLORS_JSON="$HOME/.cache/wal/colors.json"

if [ ! -f "$XRES_FILE" ] || [ ! -f "$COLORS_JSON" ]; then
    exit 0
fi

# Extract colors from colors.json and append to Xresources
python3 << 'EOF'
import json
from pathlib import Path

colors_json = Path.home() / ".cache/wal/colors.json"
xres_file = Path.home() / ".cache/wal/colors.Xresources"

try:
    with open(colors_json) as f:
        data = json.load(f)
    
    colors = data.get("colors", {})
    
    # Map wal colors to dwm color scheme
    normbgcolor = colors.get("color0", "#000000")
    normfgcolor = colors.get("color7", "#ffffff")
    selbgcolor = colors.get("color5", "#000080")
    selfgcolor = colors.get("color7", "#ffffff")
    normbordercolor = colors.get("color8", "#666666")
    selbordercolor = colors.get("color2", "#00aa00")
    
    # Read existing content
    with open(xres_file, "r") as f:
        content = f.read()
    
    # Remove old dwm colors section if it exists
    if "\n! dwm colors\n" in content:
        content = content[:content.index("\n! dwm colors\n")]
    
    # Append dwm colors
    with open(xres_file, "w") as f:
        f.write(content)
        f.write("\n! dwm colors\n")
        f.write(f"dwm.normbgcolor: {normbgcolor}\n")
        f.write(f"dwm.normfgcolor: {normfgcolor}\n")
        f.write(f"dwm.normbordercolor: {normbordercolor}\n")
        f.write(f"dwm.selbgcolor: {selbgcolor}\n")
        f.write(f"dwm.selfgcolor: {selfgcolor}\n")
        f.write(f"dwm.selbordercolor: {selbordercolor}\n")
except Exception as e:
    import sys
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(1)
EOF
