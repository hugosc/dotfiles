#!/bin/bash
# Toggle picom window transparency for kitty terminals
# Toggles between 100% (opaque) and 85% (transparent)

# Check if picom is running
if ! pgrep -x "picom" >/dev/null; then
  exit 1
fi

# Get first kitty window to check current state
first_window=$(xdotool search --class "kitty" 2>/dev/null | head -1)

if [ -z "$first_window" ]; then
  exit 1
fi

# Check current opacity
current_opacity=$(xprop -id "$first_window" _NET_WM_WINDOW_OPACITY 2>/dev/null | grep -oE '[0-9]+$')

if [ -z "$current_opacity" ]; then
  opacity_uint32=$((100 * 42949672))
else
  # Toggle: if high (opaque ~3865470976), make transparent; otherwise make opaque
  if [ "$current_opacity" -gt 3865470976 ]; then
    opacity_uint32=$((85 * 42949672))
  else
    opacity_uint32=$((100 * 42949672))
  fi
fi

# Apply to all kitty windows
xdotool search --class "kitty" 2>/dev/null | while read window_id; do
  xprop -id "$window_id" -f _NET_WM_WINDOW_OPACITY 32c -set _NET_WM_WINDOW_OPACITY "$opacity_uint32" 2>/dev/null
done
